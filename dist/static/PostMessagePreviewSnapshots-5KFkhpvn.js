import{$ as w,a0 as P,r as s,bp as S,bj as _,ct as x,c9 as E,cu as M,cv as k,cw as R,cb as $,bg as h,cs as j,an as D,ai as U,ag as y,cx as F}from"./sanity-BixSMB_v.js";function I(u){return w(function(t,a){var i=!1,n=0;t.subscribe(P(a,function(r){return(i||(i=!u(r,n++)))&&a.next(r)}))})}const O=u=>{const{comlink:t,refs:a,perspective:i}=u,n=S(),r=_(),c=s.useMemo(()=>new x,[]),l=s.useMemo(()=>c.asObservable().pipe(E(b=>M(b.map(e=>{const f={...e,_id:k(e._id)},m=i==="previewDrafts"?n.observeForPreview(f,r.get(f._type)).pipe(R(),I(o=>o.snapshot===null)):$,v={...e,_id:h(e._id)},g=n.observeForPreview(v,r.get(v._type));return j(g.pipe(D(m)),m).pipe(U(o=>!!o.snapshot),y(o=>{const p=o.snapshot;return{_id:h(p._id),title:p.title,subtitle:p.subtitle,description:p.description,imageUrl:p.imageUrl}}))}))),F(0)),[n,c,r,i]),d=s.useRef([]);return s.useEffect(()=>{const b=l.subscribe(e=>{t.post("presentation/preview-snapshots",{snapshots:e}),d.current=e});return()=>{b.unsubscribe()}},[t,l]),s.useEffect(()=>t.on("visual-editing/preview-snapshots",()=>({snapshots:d.current})),[t]),s.useEffect(()=>{c.next(a)},[a,c]),null};var N=s.memo(O);export{N as default};
