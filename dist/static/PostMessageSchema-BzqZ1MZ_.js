import{r as A,b as M,b1 as D,cy as q,u as U,au as C,cz as V,j as S,cA as B,cB as L,cC as z}from"./sanity-BixSMB_v.js";function K(n){const{validation:e}=n.type;if(!e)return!1;const r=Array.isArray(e)?e:[e];for(const i of r){let f=!1;const p=new Proxy({},{get:(g,d)=>()=>(d==="required"&&(f=!0),p)});if(typeof i=="function"&&(i(p),f)||typeof i=="object"&&i!==null&&"_required"in i&&i._required==="required")return!0}return!1}function v(n,e){let r=n;for(;r;){if(r.name===e||r.type&&r.type.name===e)return!0;r=r.type}return!1}function W(n){return v(n,"object")||n.jsonType==="object"||"fields"in n}function Y(n){return v(n,"array")}function h(n){return v(n,"reference")}function G(n){return v(n,"crossDatasetReference")}function H(n){return v(n,"string")}function J(n){return v(n,"number")}function N(n){let e=n;for(;e;){if(!e.type)return e;e=e.type}}function x(n){return"fields"in n?n.type?x(n.type).concat(n.fields):n.fields:[]}function Q(n){const e=new Set;function r(o,s){if(!e.has(o)){if(e.add(o),"fields"in o)for(const l of x(o)){const t=N(l.type);if(t.name==="document"){s.add(t);continue}let u;o.type.type?u=l.type.type.name:"jsonType"in o.type&&(u=l.type.jsonType),(u==="object"||u==="block")&&(h(l.type)?l.type.to.forEach(a=>s.add(a.type)):s.add(l.type)),r(l.type,s)}else if("of"in o)for(const l of o.of)r(l,s)}}const i=new Map;n.getTypeNames().forEach(o=>{const s=n.get(o);if(s===void 0||s.type===null)return;const l=new Set;r(s,l),i.set(s,l),e.clear()});const f=[],p=new Set,g=new Set;function d(o){if(g.has(o)||p.has(o))return;p.add(o);const s=i.get(o);s!==void 0&&s.forEach(l=>d(l)),p.delete(o),g.add(o),f.includes(o.name)||f.unshift(o.name)}for(const[o]of i)d(o);return f}const X=function(n){const e=M.c(6),{schemaType:r,theme:i}=n,{theme:f,scheme:p,tone:g}=i;let d;e[0]===Symbol.for("react.memo_cache_sentinel")?(d=new B,e[0]=d):d=e[0];const o=d,s=r.icon;let l;return e[1]!==s||e[2]!==p||e[3]!==f||e[4]!==g?(l=s?S.jsx(L,{sheet:o.instance,children:S.jsx(z,{theme:f,scheme:p,tone:g,children:A.isValidElement(s)?s:S.jsx(s,{})})}):null,e[1]=s,e[2]=p,e[3]=f,e[4]=g,e[5]=l):l=e[5],l},Z=n=>({_id:{type:"objectField",name:"_id",value:{type:"string"}},_type:{type:"objectField",name:"_type",value:{type:"string",value:n}},_createdAt:{type:"objectField",name:"_createdAt",value:{type:"string"}},_updatedAt:{type:"objectField",name:"_updatedAt",value:{type:"string"}},_rev:{type:"objectField",name:"_rev",value:{type:"string"}}});function T(n){var r;const e=(r=n.options)==null?void 0:r.list;return e&&Array.isArray(e)?{type:"union",of:e.map(i=>({type:"string",value:typeof i=="string"?i:i.value}))}:{type:"string"}}function ee(n){var r;const e=(r=n.options)==null?void 0:r.list;return e&&Array.isArray(e)?{type:"union",of:e.map(i=>({type:"number",value:typeof i=="number"?i:i.value}))}:{type:"number"}}function k(n,e=!1){const r={_ref:{type:"objectField",name:"_ref",value:{type:"string"}},_type:{type:"objectField",name:"_type",value:{type:"string",value:"reference"}},_weak:{type:"objectField",name:"_weak",value:{type:"boolean"},optional:!0}};return e&&(r._key={type:"objectField",name:"_key",value:{type:"string"}}),{type:"object",fields:r,dereferencesTo:n}}function te(n){const e=ne(n);return e.length===1?k(e[0]):{type:"union",of:e.map(r=>({type:"unionOption",name:r,value:k(r)}))}}function ne(n){const e=E(n);return[...new Set([...e.map(r=>r.name)])]}function E(n){const e="to"in n?n.to:[];return"type"in n&&h(n.type)?[...E(n.type),...e]:e}const F=new Map([["text",{type:"string"}],["url",{type:"string"}],["datetime",{type:"string"}],["date",{type:"string"}],["boolean",{type:"boolean"}],["email",{type:"string"}]]);function re(n,e){const r=new Set,{schema:i,basePath:f}=n;return Q(i).map(t=>{const u=i.get(t);if(u===void 0)return;const a=g(u);if(a!==null)return a.type==="type"&&r.add(u),a}).filter(t=>t!==void 0);function p(t){if(t.icon)return V(S.jsx(X,{schemaType:t,theme:e}))}function g(t){let u;if(t.type?u=t.type.name:"jsonType"in t&&(u=t.jsonType),u==="document"){const y=d(t);return y.type==="unknown"?null:{type:"document",name:t.name,title:typeof t.title=="string"?t.title:void 0,icon:p(t),fields:{...Z(t.name),...y.fields}}}const a=o(t);return a.type==="unknown"?null:a.type==="object"?{name:t.name,type:"type",value:{type:"object",fields:{_type:{type:"objectField",name:"_type",value:{type:"string",value:t.name}},...a.fields}}}:{name:t.name,title:typeof t.title=="string"?t.title:void 0,type:"type",value:a}}function d(t){const u={};for(const a of x(t)){const y=o(a.type);y!==null&&(u[a.name]={type:"objectField",name:a.name,title:typeof a.type.title=="string"?a.type.title:void 0,value:y,optional:K(a)===!1})}return{type:"object",fields:u}}function o(t){var a,y,b,c;if(((a=N(t))==null?void 0:a.name)==="document")return k(t.name);if(r.has(t.type))return{type:"inline",name:t.type.name};if(((b=(y=t.type)==null?void 0:y.type)==null?void 0:b.name)==="object")return{type:"inline",name:t.type.name};if(H(t))return T(t);if(J(t))return ee(t);const u=F.get(((c=t.type)==null?void 0:c.name)||"");if(u)return u;if(t.type&&F.has(t.type.name))return F.get(t.type.name);if(G(t))return{type:"unknown"};if(h(t))return te(t);if(Y(t))return l(t);if(W(t))return d(t);throw new Error(`Type "${t.name}" not found`)}function s(t,u){var b;const{options:a}=t;if(!a)return;const y={...a};return a.insertMenu&&(y.insertMenu={...a.insertMenu,views:(b=a.insertMenu.views)==null?void 0:b.map(c=>c.name==="grid"?{name:"grid",previewImageUrls:c.previewImageUrl?u.reduce((m,{name:j})=>{var w;const _=(w=c.previewImageUrl)==null?void 0:w.call(c,j);if(!_)return m;try{new URL(_),m[j]=_}catch{m[j]=new URL(_,`${window.location.origin}${f?`${f}/`:""}`).toString()}return m},{}):void 0}:c)}),y}function l(t){const u=[];for(const c of t.of){let m=o(c);const j={type:"unionOption",icon:p(c),name:c.name,title:typeof c.title=="string"?c.title:void 0,value:m};m.type==="inline"?m={type:"object",fields:{_key:R()},rest:m}:m.type==="object"&&(m.rest={type:"object",fields:{_key:R()}}),j.value=m,u.push(j)}if(u.length===0)return{type:"null"};if(u.length>1)return{type:"union",of:u,options:s(t,u)};const{name:a,title:y,value:b}=u[0];return{type:"array",of:{type:"arrayItem",name:a,title:typeof y=="string"?y:void 0,value:b}}}}function R(){return{type:"objectField",name:"_key",value:{type:"string"}}}function ie(n){const e=n.reduce((r,{id:i,path:f})=>(r[i]?r[i].add(f):r[i]=new Set([f]),r),{});return Object.entries(e)}function oe(n){const e=M.c(11),{comlink:r,perspective:i}=n,f=D(),p=q();let g,d;e[0]!==r||e[1]!==p||e[2]!==f?(g=()=>{try{const u=re(f,p);return r.post("presentation/schema",{schema:u}),r.on("visual-editing/schema",()=>({schema:u}))}catch{return}},d=[r,p,f],e[0]=r,e[1]=p,e[2]=f,e[3]=g,e[4]=d):(g=e[3],d=e[4]),A.useEffect(g,d);let o;e[5]===Symbol.for("react.memo_cache_sentinel")?(o={apiVersion:C},e[5]=o):o=e[5];const s=U(o);let l,t;return e[6]!==s||e[7]!==r||e[8]!==i?(l=()=>r.on("visual-editing/schema-union-types",async u=>{const a=ie(u.paths),y=await Promise.all(a.map(async c=>{const[m,j]=c,_=Array.from(j),w=`*[_id == $id][0]{${_.map(ae).join(",")}}`,$=await s.fetch(w,{id:m},{perspective:i,tag:"presentation-schema"}),P=_.map((I,O)=>({path:I,type:$[O]}));return{id:m,paths:P}})),b=new Map;return y.forEach(c=>{b.set(c.id,new Map(c.paths.map(ue)))}),{types:b}}),t=[r,s,i],e[6]=s,e[7]=r,e[8]=i,e[9]=l,e[10]=t):(l=e[9],t=e[10]),A.useEffect(l,t),null}function ue(n){const{path:e,type:r}=n;return[e,r]}function ae(n,e){return`"${e}": ${n}[0]._type`}var le=A.memo(oe);export{le as default};
